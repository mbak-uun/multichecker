<!DOCTYPE html>
<html lang="id" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Scanner CRUDS</title>
    <!-- DaisyUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        :root {
            --primary: #570df8;
            --secondary: #f000b8;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            background-color: #f5f5f5;
        }
        
        .navbar {
            background: linear-gradient(90deg, #570df8, #f000b8);
        }
        
        .chain-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
        }
        
        .action-btn {
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            transform: scale(1.05);
        }
        
        .modal-box {
            max-width: 800px;
            width: 90%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .table th {
            background-color: #f3f4f6;
        }
        
        .table tr:hover {
            background-color: #f9fafb;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body x-data="app()" x-init="init()">
    <!-- Navbar -->
    <div class="navbar text-primary-content">
        <div class="navbar-start">
            <div class="dropdown">
                <div tabindex="0" role="button" class="btn btn-ghost lg:hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" />
                    </svg>
                </div>
                <ul tabindex="0" class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow">
                    <li><a @click="activeTab = 'tokens'">Daftar Token</a></li>
                    <li><a @click="activeTab = 'add'">Tambah Token</a></li>
                    <li><a @click="activeTab = 'stats'">Statistik</a></li>
                </ul>
            </div>
            <a class="btn btn-ghost text-xl">Token Scanner CRUDS</a>
        </div>
        <div class="navbar-center hidden lg:flex">
            <ul class="menu menu-horizontal px-1">
                <li><a :class="{'active': activeTab === 'tokens'}" @click="activeTab = 'tokens'">Daftar Token</a></li>
                <li><a :class="{'active': activeTab === 'add'}" @click="activeTab = 'add'">Tambah Token</a></li>
                <li><a :class="{'active': activeTab === 'stats'}" @click="activeTab = 'stats'">Statistik</a></li>
            </ul>
        </div>
        <div class="navbar-end">
            <button class="btn btn-ghost btn-circle" @click="toggleTheme">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto p-4">
        <!-- Stats Section -->
        <div x-show="activeTab === 'stats'" class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Statistik Token</h2>
            <div class="stats-grid">
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">Total Token</div>
                        <div class="stat-value" x-text="tokens.length"></div>
                        <div class="stat-desc">Jumlah token yang dimonitor</div>
                    </div>
                </div>
                
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">Aktif</div>
                        <div class="stat-value" x-text="tokens.filter(t => t.status).length"></div>
                        <div class="stat-desc">Token yang aktif dimonitor</div>
                    </div>
                </div>
                
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">Chain Terbanyak</div>
                        <div class="stat-value" x-text="getMostFrequentChain()"></div>
                        <div class="stat-desc">Blockchain dengan token terbanyak</div>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 bg-base-100 p-4 rounded-box shadow">
                <h3 class="text-lg font-semibold mb-3">Distribusi per Chain</h3>
                <div class="flex flex-wrap gap-2">
                    <template x-for="chain in Object.keys(chainDistribution)" :key="chain">
                        <div class="badge badge-lg badge-primary">
                            <span x-text="chain"></span>
                            <span class="ml-1" x-text="chainDistribution[chain]"></span>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Token List Section -->
        <div x-show="activeTab === 'tokens'">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold">Daftar Token Monitoring</h2>
                
                <div class="flex gap-2">
                    <div class="form-control">
                        <input type="text" placeholder="Cari token..." class="input input-bordered w-full md:w-auto" x-model="searchQuery" @input="applyFilters" />
                    </div>
                    <div class="dropdown dropdown-bottom">
                        <div tabindex="0" role="button" class="btn btn-outline">
                            <span>Filter</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </div>
                        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                            <li>
                                <div class="form-control">
                                    <label class="label cursor-pointer justify-start gap-2">
                                        <input type="checkbox" class="checkbox checkbox-sm" x-model="filters.status" />
                                        <span class="label-text">Aktif Saja</span>
                                    </label>
                                </div>
                            </li>
                            <li class="menu-title">Chain</li>
                            <template x-for="chain in availableChains" :key="chain">
                                <li>
                                    <div class="form-control">
                                        <label class="label cursor-pointer justify-start gap-2">
                                            <input type="checkbox" class="checkbox checkbox-sm" :value="chain" x-model="filters.chains" />
                                            <span class="label-text" x-text="chain"></span>
                                        </label>
                                    </div>
                                </li>
                            </template>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="table-container bg-base-100 rounded-box shadow">
                <table class="table table-zebra">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Pair</th>
                            <th>Chain</th>
                            <th>CEX</th>
                            <th>DEX</th>
                            <th>Modal DEX</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="token in filteredTokens" :key="token.id">
                            <tr>
                                <td x-text="token.no"></td>
                                <td>
                                    <span class="font-bold" x-text="token.symbol_in"></span>
                                    <span class="text-gray-400">/</span>
                                    <span x-text="token.symbol_out"></span>
                                </td>
                                <td>
                                    <span class="badge chain-badge" :style="`background-color: ${getChainColor(token.chain)}; color: white`" x-text="token.chain"></span>
                                </td>
                                <td>
                                    <div class="flex flex-wrap gap-1">
                                        <template x-for="cex in token.selectedCexs" :key="cex">
                                            <span class="badge badge-outline" x-text="cex"></span>
                                        </template>
                                    </div>
                                </td>
                                <td>
                                    <div class="flex flex-wrap gap-1">
                                        <template x-for="dex in token.selectedDexs" :key="dex">
                                            <span class="badge badge-outline" x-text="dex"></span>
                                        </template>
                                    </div>
                                </td>
                                <td>
                                    <template x-for="(value, dex) in token.dataDexs" :key="dex">
                                        <div class="text-xs">
                                            <span x-text="dex" class="font-medium"></span>:
                                            <span x-text="`${value.left} - ${value.right}`"></span>
                                        </div>
                                    </template>
                                </td>
                                <td>
                                    <span class="badge" :class="token.status ? 'badge-success' : 'badge-error'">
                                        <span x-text="token.status ? 'Aktif' : 'Nonaktif'"></span>
                                    </span>
                                </td>
                                <td>
                                    <div class="flex gap-2">
                                        <button class="btn btn-sm btn-outline action-btn" @click="editToken(token)">Edit</button>
                                        <button class="btn btn-sm btn-error action-btn" @click="deleteToken(token.id)">Hapus</button>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <div x-show="filteredTokens.length === 0" class="text-center py-12 bg-base-100 rounded-box shadow mt-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="mt-4 text-lg font-medium">Tidak ada token yang ditemukan</p>
                <p class="text-gray-500">Coba ubah filter atau tambahkan token baru</p>
                <button class="btn btn-primary mt-4" @click="activeTab = 'add'">Tambah Token</button>
            </div>
        </div>

        <!-- Add/Edit Token Form -->
        <div x-show="activeTab === 'add'">
            <h2 class="text-2xl font-bold mb-6" x-text="editingToken ? 'Edit Token' : 'Tambah Token Baru'"></h2>
            
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <form @submit.prevent="saveToken">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Symbol In</span>
                                </label>
                                <input type="text" class="input input-bordered" x-model="formData.symbol_in" required />
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Symbol Out</span>
                                </label>
                                <input type="text" class="input input-bordered" x-model="formData.symbol_out" required />
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Chain</span>
                                </label>
                                <select class="select select-bordered" x-model="formData.chain" required>
                                    <option value="">Pilih Chain</option>
                                    <template x-for="chain in availableChains" :key="chain">
                                        <option :value="chain" x-text="chain"></option>
                                    </template>
                                </select>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">No</span>
                                </label>
                                <input type="number" class="input input-bordered" x-model="formData.no" required />
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Smart Contract In</span>
                                </label>
                                <input type="text" class="input input-bordered" x-model="formData.sc_in" required />
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Smart Contract Out</span>
                                </label>
                                <input type="text" class="input input-bordered" x-model="formData.sc_out" required />
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Decimal In</span>
                                </label>
                                <input type="number" class="input input-bordered" x-model="formData.des_in" required />
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Decimal Out</span>
                                </label>
                                <input type="number" class="input input-bordered" x-model="formData.des_out" required />
                            </div>
                            
                            <div class="form-control md:col-span-2">
                                <label class="label">
                                    <span class="label-text">CEX yang Dipilih</span>
                                </label>
                                <div class="flex flex-wrap gap-2">
                                    <template x-for="cex in availableCexs" :key="cex">
                                        <label class="cursor-pointer label justify-start gap-2">
                                            <input type="checkbox" class="checkbox checkbox-sm" :value="cex" x-model="formData.selectedCexs" />
                                            <span class="label-text" x-text="cex"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>
                            
                            <div class="form-control md:col-span-2">
                                <label class="label">
                                    <span class="label-text">DEX yang Dipilih</span>
                                </label>
                                <div class="flex flex-wrap gap-2">
                                    <template x-for="dex in availableDexs" :key="dex">
                                        <label class="cursor-pointer label justify-start gap-2">
                                            <input type="checkbox" class="checkbox checkbox-sm" :value="dex" x-model="formData.selectedDexs" />
                                            <span class="label-text" x-text="dex"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>
                            
                            <div class="form-control md:col-span-2">
                                <label class="label">
                                    <span class="label-text">Modal DEX (Kiri - Kanan)</span>
                                </label>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <template x-for="dex in formData.selectedDexs" :key="dex">
                                        <div class="flex items-center gap-2">
                                            <span class="font-medium w-20" x-text="dex"></span>
                                            <input type="number" class="input input-bordered w-20" placeholder="Kiri" x-model="formData.dataDexs[dex].left" />
                                            <span class="mx-1">-</span>
                                            <input type="number" class="input input-bordered w-20" placeholder="Kanan" x-model="formData.dataDexs[dex].right" />
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <div class="form-control">
                                <label class="cursor-pointer label justify-start gap-2">
                                    <input type="checkbox" class="toggle toggle-primary" x-model="formData.status" />
                                    <span class="label-text">Status Aktif</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="card-actions justify-end mt-6">
                            <button type="button" class="btn btn-ghost" @click="cancelEdit">Batal</button>
                            <button type="submit" class="btn btn-primary">Simpan</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer footer-center p-4 bg-base-300 text-base-content mt-8">
        <aside>
            <p>Token Scanner CRUDS - © 2023</p>
        </aside>
    </footer>

    <script>
        // Konfigurasi chains, CEX, dan DEX
        const CONFIG = {
            chains: ['ETHEREUM', 'BSC', 'POLYGON', 'ARBITRUM', 'BASE'],
            cexs: ['BINANCE', 'GATE', 'MEXC', 'INDODAX'],
            dexs: ['1inch', 'odos', 'kyberswap', '0x', 'okx', 'lifi'],
            chainColors: {
                'ETHEREUM': '#8098ee',
                'BSC': '#f0af18',
                'POLYGON': '#a05df6',
                'ARBITRUM': '#a6b0c3',
                'BASE': '#1e46f9'
            }
        };

        function app() {
            return {
                activeTab: 'tokens',
                tokens: [],
                filteredTokens: [],
                editingToken: null,
                searchQuery: '',
                filters: {
                    status: false,
                    chains: []
                },
                formData: {
                    id: '',
                    no: '',
                    symbol_in: '',
                    symbol_out: '',
                    chain: '',
                    sc_in: '',
                    des_in: 18,
                    sc_out: '',
                    des_out: 18,
                    status: true,
                    selectedCexs: [],
                    selectedDexs: [],
                    dataDexs: {},
                    dataCexs: {}
                },
                availableChains: CONFIG.chains,
                availableCexs: CONFIG.cexs,
                availableDexs: CONFIG.dexs,
                chainColors: CONFIG.chainColors,
                
                init() {
                    this.loadTokens();
                    this.applyFilters();
                },
                
                loadTokens() {
                    const storedTokens = localStorage.getItem('TOKEN_SCANNER');
                    if (storedTokens) {
                        this.tokens = JSON.parse(storedTokens);
                    } else {
                        // Load default tokens if none in storage
                        this.tokens = [
                            {
                                "id": "1755255277617",
                                "no": 27,
                                "symbol_in": "MDT",
                                "symbol_out": "BNT",
                                "chain": "ETHEREUM",
                                "sc_in": "0x814e0908b12A99FeCf5BC101bB5d0b8B5cDf7d26",
                                "des_in": 18,
                                "sc_out": "0x1F573D6Fb3F13d689FF844B4cE37794d79a7FF1C",
                                "des_out": 18,
                                "dataCexs": {
                                    "GATE": {
                                        "feeWDToken": 33.92,
                                        "feeWDPair": 1.48,
                                        "depositToken": true,
                                        "withdrawToken": true,
                                        "depositPair": true,
                                        "withdrawPair": true
                                    }
                                },
                                "dataDexs": {
                                    "odos": {
                                        "left": 900,
                                        "right": 800
                                    },
                                    "okx": {
                                        "left": 1000,
                                        "right": 900
                                    },
                                    "lifi": {
                                        "left": 1200,
                                        "right": 1100
                                    }
                                },
                                "status": true,
                                "selectedCexs": ["GATE"],
                                "selectedDexs": ["odos", "okx", "lifi"]
                            },
                            {
                                "id": "1755139960907",
                                "no": 396,
                                "symbol_in": "ETC",
                                "symbol_out": "UNI",
                                "chain": "BSC",
                                "sc_in": "0x3d6545b08693daE087E957cb1180ee38B9e3c25E",
                                "des_in": 18,
                                "sc_out": "0xBf5140A22578168FD562DCcF235E5D43A02ce9B1",
                                "des_out": 18,
                                "dataCexs": {
                                    "BINANCE": {
                                        "feeWDToken": "0.00073",
                                        "feeWDPair": "0.0016",
                                        "depositToken": true,
                                        "withdrawToken": true,
                                        "depositPair": true,
                                        "withdrawPair": true
                                    }
                                },
                                "dataDexs": {
                                    "1inch": {
                                        "left": 1000,
                                        "right": 1000
                                    },
                                    "odos": {
                                        "left": 500,
                                        "right": 500
                                    },
                                    "kyberswap": {
                                        "left": 400,
                                        "right": 400
                                    },
                                    "lifi": {
                                        "left": 300,
                                        "right": 300
                                    }
                                },
                                "status": true,
                                "selectedCexs": ["BINANCE"],
                                "selectedDexs": ["1inch", "odos", "kyberswap", "lifi"]
                            }
                        ];
                        this.saveTokens();
                    }
                    
                    this.applyFilters();
                },
                
                saveTokens() {
                    localStorage.setItem('TOKEN_SCANNER', JSON.stringify(this.tokens));
                },
                
                applyFilters() {
                    this.filteredTokens = this.tokens.filter(token => {
                        // Filter by search query
                        if (this.searchQuery) {
                            const query = this.searchQuery.toLowerCase();
                            if (!token.symbol_in.toLowerCase().includes(query) && 
                                !token.symbol_out.toLowerCase().includes(query) &&
                                !token.chain.toLowerCase().includes(query)) {
                                return false;
                            }
                        }
                        
                        // Filter by status
                        if (this.filters.status && !token.status) {
                            return false;
                        }
                        
                        // Filter by chains
                        if (this.filters.chains.length > 0 && !this.filters.chains.includes(token.chain)) {
                            return false;
                        }
                        
                        return true;
                    });
                },
                
                saveToken() {
                    if (this.editingToken) {
                        // Update existing token
                        const index = this.tokens.findIndex(t => t.id === this.editingToken.id);
                        if (index !== -1) {
                            this.tokens[index] = {...this.formData};
                        }
                    } else {
                        // Add new token
                        const newToken = {
                            ...this.formData,
                            id: Date.now().toString()
                        };
                        this.tokens.push(newToken);
                    }
                    
                    this.saveTokens();
                    this.resetForm();
                    this.activeTab = 'tokens';
                    this.applyFilters();
                    
                    // Show success message
                    alert('Token berhasil disimpan!');
                },
                
                editToken(token) {
                    this.editingToken = token;
                    this.formData = {...token};
                    this.activeTab = 'add';
                },
                
                deleteToken(id) {
                    if (confirm('Apakah Anda yakin ingin menghapus token ini?')) {
                        this.tokens = this.tokens.filter(token => token.id !== id);
                        this.saveTokens();
                        this.applyFilters();
                        
                        // Show success message
                        alert('Token berhasil dihapus!');
                    }
                },
                
                cancelEdit() {
                    this.resetForm();
                    this.activeTab = 'tokens';
                },
                
                resetForm() {
                    this.editingToken = null;
                    this.formData = {
                        id: '',
                        no: '',
                        symbol_in: '',
                        symbol_out: '',
                        chain: '',
                        sc_in: '',
                        des_in: 18,
                        sc_out: '',
                        des_out: 18,
                        status: true,
                        selectedCexs: [],
                        selectedDexs: [],
                        dataDexs: {},
                        dataCexs: {}
                    };
                    
                    // Initialize empty dataDexs for selected DEXs
                    this.availableDexs.forEach(dex => {
                        this.formData.dataDexs[dex] = { left: 0, right: 0 };
                    });
                },
                
                getChainColor(chain) {
                    return this.chainColors[chain] || '#6b7280';
                },
                
                toggleTheme() {
                    const html = document.documentElement;
                    const currentTheme = html.getAttribute('data-theme');
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    html.setAttribute('data-theme', newTheme);
                },
                
                get chainDistribution() {
                    const distribution = {};
                    this.tokens.forEach(token => {
                        distribution[token.chain] = (distribution[token.chain] || 0) + 1;
                    });
                    return distribution;
                },
                
                getMostFrequentChain() {
                    if (this.tokens.length === 0) return '-';
                    
                    const chainCount = {};
                    this.tokens.forEach(token => {
                        chainCount[token.chain] = (chainCount[token.chain] || 0) + 1;
                    });
                    
                    return Object.keys(chainCount).reduce((a, b) => 
                        chainCount[a] > chainCount[b] ? a : b
                    );
                }
            };
        }
    </script>
</body>
</html>